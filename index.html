<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A minha biblioteca musical</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: auto;
        }
        .track {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #181818;
            border-radius: 5px;
            margin: 5px 0;
        }
        audio {
            width: 150px;
        }
        .playlist {
            margin-top: 20px;
            padding: 10px;
            background-color: #222;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Minha Biblioteca de Músicas</h1>
    <div class="container" id="music-list"></div>
    <h2>Minha Playlist</h2>
    <div class="playlist" id="playlist"></div>
    
    <script>
        const repoOwner = "sivoplaka";
        const repoName = "MuplaOn";
        const musicFolder = "music";
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${musicFolder}`;
        
        let playlist = [];
        
        async function fetchMusic() {
            try {
                const response = await fetch(apiUrl);
                const files = await response.json();
                
                const musicList = document.getElementById("music-list");
                musicList.innerHTML = "";
                
                files.forEach(file => {
                    if (file.name.endsWith(".mp3")) {
                        const track = document.createElement("div");
                        track.className = "track";
                        
                        const audio = document.createElement("audio");
                        audio.controls = true;
                        audio.src = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${musicFolder}/${file.name}`;
                        audio.addEventListener("play", () => {
                            document.title = file.name.replace(/_/g, ' ').replace('.mp3', '');
                        });
                        
                        const addButton = document.createElement("button");
                        addButton.innerText = "+ Playlist";
                        addButton.onclick = () => addToPlaylist(file.name, audio.src);
                        
                        track.appendChild(document.createTextNode(file.name.replace(/_/g, ' ').replace('.mp3', '')));
                        track.appendChild(audio);
                        track.appendChild(addButton);
                        
                        musicList.appendChild(track);
                    }
                });
            } catch (error) {
                console.error("Erro ao procurar as músicas:", error);
            }
        }
        
        function addToPlaylist(name, src) {
            if (!playlist.some(track => track.name === name)) {
                playlist.push({ name, src });
                renderPlaylist();
            }
        }
        
        function renderPlaylist() {
            const playlistDiv = document.getElementById("playlist");
            playlistDiv.innerHTML = "";
            
            playlist.forEach(track => {
                const trackElement = document.createElement("div");
                trackElement.innerText = track.name.replace(/_/g, ' ').replace('.mp3', '');
                
                const removeButton = document.createElement("button");
                removeButton.innerText = "Remover";
                removeButton.onclick = () => {
                    playlist = playlist.filter(t => t.name !== track.name);
                    renderPlaylist();
                };
                
                trackElement.appendChild(removeButton);
                playlistDiv.appendChild(trackElement);
            });
        }
        
        fetchMusic();
    </script>
</body>
</html>
