<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Biblioteca Musical</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        .album {
            margin: 20px 0;
            padding: 10px;
            background-color: #181818;
            border-radius: 5px;
        }
        .track {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        .controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        audio {
            width: 150px;
        }
        .playlist {
            margin-top: 20px;
            padding: 10px;
            background-color: #222;
            border-radius: 5px;
        }
        .playlist-track {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #444;
        }
    </style>
</head>
<body>
    <h1>Minha Biblioteca de Músicas</h1>
    <div>
        <label for="genre-filter">Filtrar por estilo:</label>
        <select id="genre-filter" onchange="filterMusic()">
            <option value="">Todos</option>
        </select>
    </div>
    <div class="container" id="music-list"></div>
    
    <h2>Minha Playlist</h2>
    <div class="playlist" id="playlist"></div>

    <script>
        const repoOwner = "sivoplaka";
        const repoName = "MuplaOn";
        const musicFolder = "music";
        const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${musicFolder}`;
        const playlist = [];
        let musicData = [];
        
        async function fetchMusic() {
            try {
                const response = await fetch(apiUrl);
                const files = await response.json();
                
                musicData = files.filter(file => file.name.endsWith(".mp3"));
                renderMusic();
            } catch (error) {
                console.error("Erro ao procurar as músicas:", error);
            }
        }

        function renderMusic() {
            const musicList = document.getElementById("music-list");
            const genreFilter = document.getElementById("genre-filter");
            musicList.innerHTML = "";
            
            let albums = {};
            musicData.forEach(file => {
                const [artist, album, song] = file.name.replace('.mp3', '').split(" - ");
                const genre = "Pop"; // Alterar para um sistema dinâmico depois
                
                if (!albums[album]) {
                    albums[album] = { artist, genre, tracks: [] };
                }
                albums[album].tracks.push({ song, url: file.download_url });
            });
            
            Object.keys(albums).forEach(album => {
                const albumDiv = document.createElement("div");
                albumDiv.className = "album";
                albumDiv.innerHTML = `<h3>${albums[album].artist} - ${album}</h3>`;
                
                albums[album].tracks.forEach(track => {
                    const trackDiv = document.createElement("div");
                    trackDiv.className = "track";
                    trackDiv.innerHTML = `
                        <span>${track.song}</span>
                        <div class="controls">
                            <audio controls onplay="updateTitle('${track.song}')">
                                <source src="https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${musicFolder}/${track.song}.mp3" type="audio/mpeg">
                            </audio>
                            <button onclick="addToPlaylist('${track.song}', '${track.url}')">➕</button>
                        </div>
                    `;
                    albumDiv.appendChild(trackDiv);
                });
                
                musicList.appendChild(albumDiv);
            });
        }

        function addToPlaylist(song, url) {
            if (!playlist.some(track => track.song === song)) {
                playlist.push({ song, url });
                renderPlaylist();
            }
        }

        function removeFromPlaylist(index) {
            playlist.splice(index, 1);
            renderPlaylist();
        }

        function renderPlaylist() {
            const playlistDiv = document.getElementById("playlist");
            playlistDiv.innerHTML = "";
            
            playlist.forEach((track, index) => {
                const trackDiv = document.createElement("div");
                trackDiv.className = "playlist-track";
                trackDiv.innerHTML = `
                    <span>${track.song}</span>
                    <button onclick="removeFromPlaylist(${index})">❌</button>
                `;
                playlistDiv.appendChild(trackDiv);
            });
        }

        function updateTitle(song) {
            document.title = song;
        }

        fetchMusic();
    </script>
</body>
</html>
